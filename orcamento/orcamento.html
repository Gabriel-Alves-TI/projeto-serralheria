<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orçamento</title>
    <!--BOOTSTRAP ICONS-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!--FIM BOOTSTRAP ICONS-->
    <link rel="stylesheet" href="styles.css">
    <script src="script.js" defer></script>
    <!--GERADOR DE PDF-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!--FIM GERADOR DE PDF-->
    <link rel="icon" type="image/png" sizes="32x32" href="../imagens/favicon-orcamento-32x32.png">
</head>
<body>
    <div class="voltar">
        <p>Voltar</p>
        <button class="btn-voltar">
            <a href="../index.html"><i class="bi bi-arrow-return-left"></i></a>
        </button>
    </div>
    <div id="content">
        <section>
            <header>
                <div class="cabecalho">
                    
                    <div class="img-cabecalho">
                        <img src="../imagens/Logo LM.png" alt="Logo LM SERRALHERIA">
                    </div>

                    <div class="info_empresa">
                        <p id="nome_empresa">LM SERRALHERIA</p>
                        <p><span>CNPJ:</span> 17.317.683/0001-08</p>
                        <p><span>E-mail:</span> jaimejrmenezes_@outlook.com</p>
                        <p><span>Endereço:</span> Rua Itá, 69-Jardim Petroni-SBC/SP</p>
                        <p><span>Telefone/WhatsApp:</span> (11) 98415-5644</p>
                    </div>
                </div>
            </header>
        </section>

        <section>
            <div class="titulo">
                <h1>ORÇAMENTO Nº<input type="text" id="numOrc" required></h1>
            </div>
            <div class="data">
                <h5>Data:</h5>
                <p id="data">00-00-0000</p>
            </div><!--
            <div class="desc-orcamento">
                <p>Descrição:</p>
                <textarea name="" id="descricao"></textarea>
            </div>-->
            <div class="form_cliente">
                <form action="">
                    <div class="form-group">
                        <label for="cliente" class="formDados">Cliente:</label>
                        <input type="text" id="cliente">
                    </div>
                    <div class="form-group">
                        <label for="endereco" class="formDados">Endereço:</label>
                        <input type="text" id="endereco">
                    </div>
                    <div class="form-group">
                        <label for="telefone">Telefone:</label>
                        <input type="tel" placeholder="(11) 98765-4321" id="telefone" onkeyup="handlePhone(event)">
                    </div>
                </form>
            </div><!--form_cliente-->
            <div class="form_validade">
                <form action="">
                    <label for="">Validade da Proposta:</label>
                    <input type="number" class="numero"><span>Dias</span><br>
                    <label for=""  id="previsao">Previsão de Entrega:</label>
                    <input type="number" class="numero"><span>Dias</span>
                </form>
            </div><!--form_validade-->
        </section>

        <section>
            <div class="container">
                <div class="titulo-itens">
                    <h3>Descrição dos Itens</h3>
                </div>
                <div class="itens" id="itens">
                    <form id="novo-item">
                        <textarea name="" id="input_item" placeholder="Adicione um novo item"></textarea>
                        <button class="btn-item" type="submit">
                            <i id="add-item" class="bi bi-plus-square-fill"></i>
                        </button>
                    </form>
                    <div class="total-item">
                        <div class="item-material">
                            <p>Valor Material: R$</p><input type="text" id="item-material" class="material">
                        </div>
                        <div class="item-servicos">
                            <p>Valor Serviços: R$</p><input type="text" id="item-servicos" class="servicos">
                        </div>
                    </div>
                </div>
            </div>
            <div class="lista_item" id="lista_item">
            <!--    <div class="create">
                <h3>Novo Item que deve ser grande demais para caber em outra linha...</h3>
                <hr>
                <div class="total-item">
                    <div class="item-material">
                        <p><strong>Valor Material:</strong> R$ ${valorMaterial}</p>
                    </div>
                    <div class="item-servicos">
                        <p><strong>Valor Serviços:</strong> R$ ${valorServicos}</p>
                    </div>
                    <div class="item-total">
                        <p><strong>Valor Total:</strong> R$ ${valorTotal}</p>
                    </div>
                </div>
                <button class="edit-item" id="edit-item">
                    <i class="bi bi-pencil-square"></i>
                </button>
                <button class="remove-item" id="remove-item">
                    <i class="bi bi-trash"></i>
                </button>
                </div>-->
            </div>

        </section>

        <div class="divisoria"></div>

        <section>
            <div class="total">
                <div class="text-material">
                    <p>Valor Material: <input type="text" class="input_total" id="total-material"></p>
                </div>
                <div class="text-servicos">
                    <p>Valor Serviços: <input type="text" class="input_total" id="total-servicos"></p>
                </div>
                <div class="text-total">
                    <p>Valor Total: <input type="text" class="input_total" id="total"></p>
                </div>
            </div>

            <div class="divisoria"></div>

            <div class="pagamento">
                <div class="titulo-pagamento">
                    <h3>Dados do Pagamento</h3>
                </div>
            </div>
            <div class="forma-pagamento">
                <form action="">
                    <label for="">Materiais</label>
                    <textarea name="" id="" cols="80" rows="2" class="textarea">À VISTA</textarea>
                    <label for="">Mão de Obra</label>
                    <textarea name="" id="" cols="80" rows="2" class="textarea">AO TÉRMINO DO SERVIÇO A VISTA OU EM PARCELAS</textarea>
                    <label for="">Forma de Pagamento</label>
                    <textarea name="" id="" cols="80" rows="2" class="textarea" autocorrect="on">PIX; TRANSFERÊNCIA BANCÁRIA; DINHEIRO</textarea>
                    <label for="">Observações</label>
                    <textarea name="" id="" cols="80" rows="2" class="textarea"></textarea>
                </form>
            </div>
            <div class="assinatura">
                <div class="ass-cliente">
                    <p>Assinatura Cliente</p>
                </div>
                <div class="ass-prestador">
                    <p>Assinatura Prestador</p>
                </div>
                <div class="img-assinatura">
                    <img src="../imagens/assinatura.png" alt="">
                </div>
                <div class="linha"></div>
            </div>
        </section>
    </div><!--content-->
        <div class="btn-pdf">
            <button type="submit" id="generate-pdf">Gerar PDF</button>
        </div>


        <script>
            document.getElementById('generate-pdf').addEventListener('click', () => {
            const { jsPDF } = window.jspdf;

            // Obter os valores dos inputs para gerar o nome do arquivo
            const numOrcInput = document.getElementById('numOrc');
            const clienteInput = document.getElementById('cliente');

            if (!numOrcInput || !clienteInput) {
                alert('Por favor, preencha os campos Nº Orçamento e Cliente.');
                return;
            }

            const numOrc = numOrcInput.value;
            const cliente = clienteInput.value;

            if (!numOrc || !cliente) {
                alert('Por favor, preencha os campos Nº Orçamento e Cliente.');
                return;
            }

            const fileName = `ORÇAMENTO - ${numOrc} - ${cliente}.pdf`;

            // Selecionar o conteúdo da página que será transformado em PDF
            const content = document.body;

            // Ocultar elementos indesejados
            const inputs = content.querySelectorAll('input, textarea, #novo-item, .edit-item, .remove-item, .itens, .btn-pdf, .voltar');
            inputs.forEach(input => {
                input.style.display = 'none';
            });

            // Trocar inputs pelo texto inserido
            const textInputs = content.querySelectorAll('input[type="text"], input[type="tel"], input[type="number"], textarea');
            textInputs.forEach(input => {
                const textNode = document.createTextNode(input.value);
                input.parentNode.replaceChild(textNode, input);
            });

            // Criar o PDF
            html2canvas(content, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');

                // Definir as dimensões da página A4 em mm
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();

                // Definir as dimensões da imagem para preencher a página A4
                const imgWidth = 320;
                const imgHeight = 297;

                // Centralizar a imagem na folha A4
                const xOffset = -55;
                const yOffset = 0;

                pdf.addImage(imgData, 'PNG', xOffset, yOffset, imgWidth, imgHeight);
                pdf.save(fileName);

                // Restaurar elementos ocultos
                inputs.forEach(input => {
                    input.style.display = '';
                });

                // Recarregar a página para restaurar os inputs
                location.reload();
            });
        });
        </script>
</body>
</html>